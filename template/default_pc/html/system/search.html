<div class="header">
  <div class="header-inner">
    <div class="logo">
      <a href="/"><img src="{$maccms.site_logo|mac_url_img}" alt="{$maccms.site_name}" /></a>
    </div>
    <select name="platform_lang" class="lang_switch">
      <option {if mac_get_platform_lang()=='vi-vn' }selected {/if} value="vi-vn">{:platform_lang('platform/system/headtop/lang_vi-vn')}</option>
      <option {if mac_get_platform_lang()=='en-us' }selected {/if} value="en-us">{:platform_lang('platform/system/headtop/lang_en-us')}</option>
      <option {if mac_get_platform_lang()=='zh-tw' }selected {/if} value="zh-tw">{:platform_lang('platform/system/headtop/lang_zh-tw')}</option>
    </select>
    {if condition="$GLOBALS['user']['user_id']" gt 0}
    <div class="member-links">
      <ul>
        <li>
          <div class="icon">
            <img src="/MDassets/img/diamond.png" />
          </div>
          <a href="{:mac_url('user/upgrade')}">{:platform_lang('platform/system/search/user_top_up')}</a>
        </li>
        <li class="userTool">
          <div class="icon user">
            <img src="/MDassets/img/user.png" />
          </div>
          <a href="{:mac_url('user/index')}">{:platform_lang('platform/system/search/user_center')}</a>
          <div class="hoverBox">
            <div class="msg">
              <ul>
                <li>
                  <p>{:platform_lang('platform/system/search/points_available')}</p>
                  <div class="num">
                    <span id="tvPoint"></span>
                  </div>
                  <a href="{:mac_url('user/upgrade')}">
                    <div class="btn">
                      {:platform_lang('platform/system/search/top_up')}
                    </div>
                  </a>
                </li>
                <li>
                  <p><span id="tvSort"></span></p>
                  <div class="num"><span id="tvTime"></span></div>
                  <a href="{:mac_url('user/upgrade')}">
                    <div class="btn">{:platform_lang('platform/system/search/vip_extend')}</div>
                  </a>
                </li>
              </ul>
            </div>
            <div class="tool">
              <table>
                <tr>
                  <td>
                    <a href="{:mac_url('user/info')}">
                      <div class="icon">
                        <img src="/MDassets/img/icons/userMenu/lock.svg" />
                      </div>
                      <span>{:platform_lang('platform/system/search/modify_pwd')}</span>
                    </a>
                  </td>
                  <td>
                    <a href="{:mac_url('user/favs')}">
                      <div class="icon">
                        <img src="/MDassets/img/icons/userMenu/star.svg" />
                      </div>
                      <span>{:platform_lang('platform/system/search/favorites')}</span>
                    </a>
                  </td>
                  <td>
                    <a href="{:mac_url('user/plays')}">
                      <div class="icon">
                        <img src="/MDassets/img/icons/userMenu/video.svg" />
                      </div>
                      <span>{:platform_lang('platform/system/search/play_history')}</span>
                    </a>
                  </td>
                </tr>
                <tr>
                  <td>
                    <a href="{:mac_url('user/upgrade')}">
                      <div class="icon">
                        <img src="/MDassets/img/icons/userMenu/crown.svg" />
                      </div>
                      <span>{:platform_lang('platform/system/search/upgrade')}</span>
                    </a>
                  </td>
                  <td>
                    <a href="{$maccms.site_service_url}">
                      <div class="icon">
                        <img src="/MDassets/img/icons/userMenu/hp.svg" />
                      </div>
                      <span>{:platform_lang('platform/system/search/live_service')}</span>
                    </a>
                  </td>
                  <td>
                    <a href="{:mac_url('user/logout')}">
                      <div class="icon">
                        <img src="/MDassets/img/icons/userMenu/signout.svg" />
                      </div>
                      <span>{:platform_lang('platform/system/search/logout')}</span>
                    </a>
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </li>
      </ul>
    </div>
    {else/}
    <div class="member-links">
      <ul>
        <li>
          <div class="icon">
            <img src="/MDassets/img/diamond.png" />
          </div>
          <a data-href="/index.php/label/login.html" data-fancybox="ajax">{:platform_lang('platform/system/search/user_top_up')}</a>
        </li>
        <li>
          <div class="icon user">
            <img src="/MDassets/img/user.png" />
          </div>
          <div class="user">
            <div>
              <a data-href="{:mac_url('label/login')}" data-fancybox="ajax" id="login">{:platform_lang('platform/system/search/login')}</a>
            </div>
            <div>
              <a data-href="{:mac_url('label/signup')}" data-fancybox="ajax">{:platform_lang('platform/system/search/register')}</a>
            </div>
          </div>
        </li>
      </ul>
    </div>
    {/if}
  </div>
</div>

<script>
  function tcalcTime() {
    let endTime = `{$user.user_end_time}`;
    let nowTime = new Date();
    let timeCut = endTime * 1000 - nowTime.getTime();
    let tt = timeCut < 0 ? 0 : timeCut;
    let lastDay = parseInt(tt / (60 * 60 * 24 * 1000));
    let lastHonr = parseInt(tt / (60 * 60 * 1000));

    let getTime;
    if (lastDay > 0) {
      getTime = { sort: "{:platform_lang('platform/user/menu/vip_title_day')}", data: lastDay };
    } else {
      getTime = { sort: "{:platform_lang('platform/user/menu/vip_title_hour')}", data: lastHonr };
    }

    $("#tvSort").text(getTime.sort);
    if (`{$user.user_end_time}` == '') {
      $("#tvTime").text('*');
    } else {
      if (`{$user.user_end_time}` > 0) {
        $("#tvTime").text(getTime.data);
      } else {
        $("#tvTime").text('0');
      }
    }
  }

  function tcalcPoint() {
    let point = `{$user.user_points}`;
    let lestP =
      point > 1000 ? `${Math.floor((point / 1000) * 10) / 10}k` : point;
    if (`{$user.user_points}` == '') {
      $("#tvPoint").text('*');
    } else {
      $("#tvPoint").text(lestP);
    }

  }

  setInterval(function () {
    tcalcTime();
  }, 1000);
  tcalcTime();
  tcalcPoint();
</script>